\hypertarget{TestNewLattice2_8cc_source}{}\doxysection{Test\+New\+Lattice2.\+cc}
\label{TestNewLattice2_8cc_source}\index{tests/TestNewLattice2.cc@{tests/TestNewLattice2.cc}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{// testlattice.cpp}}
\DoxyCodeLine{00002 \textcolor{comment}{//}}
\DoxyCodeLine{00003 \textcolor{comment}{// Testing the Latice class (basis for binomial and trinomial}}
\DoxyCodeLine{00004 \textcolor{comment}{// trees)}}
\DoxyCodeLine{00005 \textcolor{comment}{//}}
\DoxyCodeLine{00006 \textcolor{comment}{// In this version we have one class for both binomial and trinomial}}
\DoxyCodeLine{00007 \textcolor{comment}{// trees.}}
\DoxyCodeLine{00008 \textcolor{comment}{//}}
\DoxyCodeLine{00009 \textcolor{comment}{//  2005-\/1-\/5 DD Using namespaces}}
\DoxyCodeLine{00010 \textcolor{comment}{//}}
\DoxyCodeLine{00011 \textcolor{comment}{// (C) Datasim Education BV 2003-\/2005}}
\DoxyCodeLine{00012 \textcolor{comment}{//}}
\DoxyCodeLine{00013 }
\DoxyCodeLine{00014 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{Lattice_8hh}{duffy/Lattice.hh}}>}}
\DoxyCodeLine{00015 \textcolor{comment}{// \#include <duffy/ArrayMechanisms.hh>}}
\DoxyCodeLine{00016 \textcolor{preprocessor}{\#include "../src/TestLatticeNamespace.cc"}}
\DoxyCodeLine{00017 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{00018 \textcolor{preprocessor}{\#include <cmath>}}
\DoxyCodeLine{00019 }
\DoxyCodeLine{00020 }
\DoxyCodeLine{\Hypertarget{TestNewLattice2_8cc_source_l00021}\mbox{\hyperlink{TestNewLattice2_8cc_afcc8086e4f916ae9b6445dc906071622}{00021}} \textcolor{keyword}{template} <\textcolor{keyword}{class} V, \textcolor{keyword}{class} I> \mbox{\hyperlink{classVector}{Vector<V,I>}} \mbox{\hyperlink{TestNewLattice2_8cc_afcc8086e4f916ae9b6445dc906071622}{CallPayOff}}(\textcolor{keyword}{const} V\& \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, \textcolor{keyword}{const} \mbox{\hyperlink{classVector}{Vector<V,I>}}\& StockArr)}
\DoxyCodeLine{00022 \{}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024         V tmp;}
\DoxyCodeLine{00025 }
\DoxyCodeLine{00026         \mbox{\hyperlink{classVector}{Vector<V,I>}} result (StockArr.\mbox{\hyperlink{classArray_a69342621906b355e8244466f9eeece71}{Size}}(), StockArr.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}());}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028         \textcolor{keywordflow}{for} (I i = StockArr.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}(); i <= StockArr.\mbox{\hyperlink{classArray_a8ce7791cd1ec7ba63ec71772a7144965}{MaxIndex}}(); i++)}
\DoxyCodeLine{00029         \{}
\DoxyCodeLine{00030             result[i] = 0.0;}
\DoxyCodeLine{00031             tmp = StockArr[i] -\/ \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}};}
\DoxyCodeLine{00032             \textcolor{keywordflow}{if} (tmp > 0.0)}
\DoxyCodeLine{00033                 result[i] = tmp;}
\DoxyCodeLine{00034         \}}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00037 \}}
\DoxyCodeLine{00038 }
\DoxyCodeLine{\Hypertarget{TestNewLattice2_8cc_source_l00039}\mbox{\hyperlink{TestNewLattice2_8cc_a30a47c60854db7b413b641236b4157d2}{00039}} \textcolor{keyword}{template} <\textcolor{keyword}{class} V, \textcolor{keyword}{class} I> \mbox{\hyperlink{classVector}{Vector<V,I>}} \mbox{\hyperlink{TestNewLattice2_8cc_a30a47c60854db7b413b641236b4157d2}{PutPayOff}}(\textcolor{keyword}{const} V\& \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, \textcolor{keyword}{const} \mbox{\hyperlink{classVector}{Vector<V,I>}}\& StockArr)}
\DoxyCodeLine{00040 \{}
\DoxyCodeLine{00041 }
\DoxyCodeLine{00042         V tmp;}
\DoxyCodeLine{00043 }
\DoxyCodeLine{00044         \mbox{\hyperlink{classVector}{Vector<V,I>}} result (StockArr.\mbox{\hyperlink{classArray_a69342621906b355e8244466f9eeece71}{Size}}(), StockArr.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}());}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046         \textcolor{keywordflow}{for} (I i = StockArr.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}(); i <= StockArr.\mbox{\hyperlink{classArray_a8ce7791cd1ec7ba63ec71772a7144965}{MaxIndex}}(); i++)}
\DoxyCodeLine{00047         \{}
\DoxyCodeLine{00048             result[i] = 0.0;}
\DoxyCodeLine{00049             tmp = \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}} -\/ StockArr[i];}
\DoxyCodeLine{00050             \textcolor{keywordflow}{if} (tmp > 0.0)}
\DoxyCodeLine{00051                 result[i] = tmp;}
\DoxyCodeLine{00052         \}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054         \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00055 \}}
\DoxyCodeLine{00056 }
\DoxyCodeLine{00057 }
\DoxyCodeLine{\Hypertarget{TestNewLattice2_8cc_source_l00058}\mbox{\hyperlink{TestNewLattice2_8cc_a4f588b04e89a733e6e27ba312ce437d3}{00058}} \textcolor{keyword}{template} <\textcolor{keyword}{class} V, \textcolor{keyword}{class} I, \textcolor{keywordtype}{int} NumberNodes> \textcolor{keywordtype}{void} \mbox{\hyperlink{TestNewLattice2_8cc_a4f588b04e89a733e6e27ba312ce437d3}{print}}(\textcolor{keyword}{const} \mbox{\hyperlink{classLattice}{Lattice<V, I, NumberNodes>}}\& source)}
\DoxyCodeLine{00059 \{}
\DoxyCodeLine{00060     }
\DoxyCodeLine{00061     \textcolor{keywordflow}{for} (I j = source.\mbox{\hyperlink{classLattice_a07442df63222c6627f46efc4ae91acf9}{MinIndex}}(); j <= source.\mbox{\hyperlink{classLattice_a5cac27496a08f2a14d8e1d65732a4c34}{MaxIndex}}(); j++)}
\DoxyCodeLine{00062     \{}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064         std::cout << \textcolor{stringliteral}{"\(\backslash\)nBranch Number "} << j << \textcolor{stringliteral}{": ["};}
\DoxyCodeLine{00065         \textcolor{keywordflow}{for} (I i = source[j].MinIndex(); i <= source[j].\mbox{\hyperlink{classLattice_a5cac27496a08f2a14d8e1d65732a4c34}{MaxIndex}}(); i++)}
\DoxyCodeLine{00066         \{}
\DoxyCodeLine{00067             std::cout << source[j][i] << \textcolor{stringliteral}{", "};}
\DoxyCodeLine{00068     }
\DoxyCodeLine{00069         \}}
\DoxyCodeLine{00070 }
\DoxyCodeLine{00071         std::cout << \textcolor{stringliteral}{"]"};}
\DoxyCodeLine{00072             }
\DoxyCodeLine{00073     \}}
\DoxyCodeLine{00074 }
\DoxyCodeLine{00075 \}}
\DoxyCodeLine{00076 }
\DoxyCodeLine{00077 }
\DoxyCodeLine{00078 }
\DoxyCodeLine{\Hypertarget{TestNewLattice2_8cc_source_l00079}\mbox{\hyperlink{TestNewLattice2_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{00079}} \textcolor{keywordtype}{int} \mbox{\hyperlink{TestNewLattice2_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()}
\DoxyCodeLine{00080 \{}
\DoxyCodeLine{00081     std::cout << \textcolor{stringliteral}{"Forward sweep, Wilmott, Student Edition p. 193\(\backslash\)n"};}
\DoxyCodeLine{00082 }
\DoxyCodeLine{00083     \textcolor{keywordtype}{int} depth;}
\DoxyCodeLine{00084     std::cout << \textcolor{stringliteral}{"How many subdivisions? "};}
\DoxyCodeLine{00085     std::cin >> depth;}
\DoxyCodeLine{00086 }
\DoxyCodeLine{00087     \textcolor{keyword}{const} \textcolor{keywordtype}{int} \mbox{\hyperlink{TestImpliedVolatility_8cc_a927694c350b26693c65f7c8b73b3dba3}{n}} = 2;}
\DoxyCodeLine{00088     \mbox{\hyperlink{classLattice}{Lattice<double, int, n>}} lattice1(depth);}
\DoxyCodeLine{00089 }
\DoxyCodeLine{00090     \mbox{\hyperlink{TestNewLattice2_8cc_a4f588b04e89a733e6e27ba312ce437d3}{print}}(lattice1);}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092     \textcolor{keyword}{using namespace }\mbox{\hyperlink{namespaceStandardLattice}{StandardLattice}};}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     \textcolor{keywordtype}{double} rootValue = 12.0;         \textcolor{comment}{// Stock price now}}
\DoxyCodeLine{00095     \textcolor{keywordtype}{double} D0 = 0.04;       \textcolor{comment}{// Dividend yield}}
\DoxyCodeLine{00096     \textcolor{keywordtype}{double} vol = 0.3;       \textcolor{comment}{// Volatility}}
\DoxyCodeLine{00097     \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}} = 0.06;       \textcolor{comment}{// Interest}}
\DoxyCodeLine{00098     \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceNSEuropeanOption_a62a4ea4e8132239d531a9760dfe36b4d}{T}} = 1.0;                \textcolor{comment}{// Time to expiry}}
\DoxyCodeLine{00099 }
\DoxyCodeLine{00100     \textcolor{keywordtype}{double} k = \mbox{\hyperlink{namespaceNSEuropeanOption_a62a4ea4e8132239d531a9760dfe36b4d}{T}} / double (depth);}
\DoxyCodeLine{00101     \textcolor{keywordtype}{double} e = \mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{std::exp}}((\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}}-\/D0)*k);}
\DoxyCodeLine{00102     \textcolor{keywordtype}{double} sr = std::sqrt(\mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{exp}}(vol*vol*k) -\/ 1.0);}
\DoxyCodeLine{00103 }
\DoxyCodeLine{00104     \textcolor{keywordtype}{double} up = e * (1.0 + sr);}
\DoxyCodeLine{00105     \textcolor{keywordtype}{double} down = e * (1.0 -\/ sr);}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107     \mbox{\hyperlink{classLattice}{Lattice<double, int, 2>}} newLattice = \mbox{\hyperlink{namespaceStandardLattice_a0ced6d331b2856d61096bdc9aaab15cd}{createLattice}}(depth, rootValue, up, down);}
\DoxyCodeLine{00108 \textcolor{comment}{//  print (newLattice);}}
\DoxyCodeLine{00109 }
\DoxyCodeLine{00110     std::cout << \textcolor{stringliteral}{"\(\backslash\)nSize of base pyramid vector: "} }
\DoxyCodeLine{00111                     << newLattice.BasePyramidVector().Size() << std::endl;}
\DoxyCodeLine{00112 }
\DoxyCodeLine{00113     \textcolor{comment}{// Now work back from the payoff function}}
\DoxyCodeLine{00114 }
\DoxyCodeLine{00115     \textcolor{comment}{// First make the discrete payoff}}
\DoxyCodeLine{00116     \textcolor{keywordtype}{double} \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}} = 10.0;}
\DoxyCodeLine{00117     \mbox{\hyperlink{classVector}{Vector<double, int>}} RHS = \mbox{\hyperlink{TestNewLattice2_8cc_afcc8086e4f916ae9b6445dc906071622}{CallPayOff}}(\mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, newLattice[newLattice.MaxIndex()]);}
\DoxyCodeLine{00118     \mbox{\hyperlink{classVector}{Vector<double, int>}} RHS2 = \mbox{\hyperlink{TestNewLattice2_8cc_a30a47c60854db7b413b641236b4157d2}{PutPayOff}}(\mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, lattice1[lattice1.\mbox{\hyperlink{classLattice_a5cac27496a08f2a14d8e1d65732a4c34}{MaxIndex}}()]);}
\DoxyCodeLine{00119 }
\DoxyCodeLine{00120     \textcolor{keywordtype}{double}  p = 0.5;}
\DoxyCodeLine{00121     \textcolor{keywordtype}{double} discounting = \mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{std::exp}}(-\/ \mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}}*k);}
\DoxyCodeLine{00122     }
\DoxyCodeLine{00123     \textcolor{keywordtype}{double} optionPrice = \mbox{\hyperlink{namespaceStandardLattice_a3e49a59024bcef068e558f70a756df05}{traverse}}(newLattice, RHS, p, discounting);}
\DoxyCodeLine{00124     \textcolor{keywordtype}{double} optionPrice2 = \mbox{\hyperlink{namespaceStandardLattice_a3e49a59024bcef068e558f70a756df05}{traverse}}(newLattice, RHS2, p, discounting);}
\DoxyCodeLine{00125 }
\DoxyCodeLine{00126     std::cout << \textcolor{stringliteral}{"\(\backslash\)nOption price C "} << optionPrice << std::endl;}
\DoxyCodeLine{00127     std::cout << \textcolor{stringliteral}{"\(\backslash\)nOption price P "} << optionPrice2 << std::endl;}
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00130 \}}

\end{DoxyCode}
