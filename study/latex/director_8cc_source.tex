\hypertarget{director_8cc_source}{}\doxysection{director.\+cc}
\label{director_8cc_source}\index{tests/director.cc@{tests/director.cc}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 \textcolor{comment}{// director.cpp}}
\DoxyCodeLine{00002 \textcolor{comment}{//}}
\DoxyCodeLine{00003 \textcolor{comment}{// Main program to run and test the Binomial method}}
\DoxyCodeLine{00004 \textcolor{comment}{// for a stock option. This code 'drives' the process}}
\DoxyCodeLine{00005 \textcolor{comment}{// as it were.}}
\DoxyCodeLine{00006 \textcolor{comment}{//}}
\DoxyCodeLine{00007 \textcolor{comment}{// 2005-\/1-\/31 DD First official code }}
\DoxyCodeLine{00008 \textcolor{comment}{//}}
\DoxyCodeLine{00009 \textcolor{comment}{// The mediator class in the Binomial method}}
\DoxyCodeLine{00010 \textcolor{comment}{// }}
\DoxyCodeLine{00011 \textcolor{comment}{// }}
\DoxyCodeLine{00012 \textcolor{comment}{// (C) Datasim Education BV 2005-\/2006}}
\DoxyCodeLine{00013 \textcolor{comment}{//}}
\DoxyCodeLine{00014 }
\DoxyCodeLine{00015 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{BinomialMethod_8hh}{duffy/BinomialMethod.hh}}>}}
\DoxyCodeLine{00016 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{BinomialLatticeStrategy_8hh}{duffy/BinomialLatticeStrategy.hh}}>}}
\DoxyCodeLine{00017 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{EuropeanOptionFactory_8hh}{duffy/EuropeanOptionFactory.hh}}>}}
\DoxyCodeLine{00018 \textcolor{preprocessor}{\#include "../src/LatticeMechanisms.cc"}}
\DoxyCodeLine{00019 }
\DoxyCodeLine{\Hypertarget{director_8cc_source_l00020}\mbox{\hyperlink{director_8cc_a6a4508a2b9d1fe00be954b686998d79e}{00020}} \mbox{\hyperlink{classEuropeanOptionFactory}{EuropeanOptionFactory}}* \mbox{\hyperlink{director_8cc_a6a4508a2b9d1fe00be954b686998d79e}{getFactory}}()}
\DoxyCodeLine{00021 \{}
\DoxyCodeLine{00022     \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classConsoleEuropeanOptionFactory}{ConsoleEuropeanOptionFactory}};}
\DoxyCodeLine{00023 \}}
\DoxyCodeLine{00024 }
\DoxyCodeLine{\Hypertarget{director_8cc_source_l00025}\mbox{\hyperlink{director_8cc_a1db1bf9e7954a5dd2efa2b2876a9a68a}{00025}} \mbox{\hyperlink{classBinomialLatticeStrategy}{BinomialLatticeStrategy}}* \mbox{\hyperlink{director_8cc_a1db1bf9e7954a5dd2efa2b2876a9a68a}{getStrategy}}(\textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}}, \textcolor{keywordtype}{double} \mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}}, \textcolor{keywordtype}{double} k, \textcolor{keywordtype}{double} S, \textcolor{keywordtype}{double} \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, \textcolor{keywordtype}{int} \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}})}
\DoxyCodeLine{00026 \{}
\DoxyCodeLine{00027     std::cout << \textcolor{stringliteral}{"\(\backslash\)n1. CRR, 2. JR, 3. TRG, 4. EQP, 5. Modified CRR:\(\backslash\)n6. Cayley JR Transform: 7 Cayley CRR: "};}
\DoxyCodeLine{00028     \textcolor{keywordtype}{int} choice;}
\DoxyCodeLine{00029     std::cin >> choice;}
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031     \textcolor{keywordflow}{if} (choice == 1)}
\DoxyCodeLine{00032         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classCRRStrategy}{CRRStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034     \textcolor{keywordflow}{if} (choice == 2)}
\DoxyCodeLine{00035         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classJRStrategy}{JRStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037     \textcolor{keywordflow}{if} (choice == 3)}
\DoxyCodeLine{00038         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classTRGStrategy}{TRGStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00039 }
\DoxyCodeLine{00040     \textcolor{keywordflow}{if} (choice == 4)}
\DoxyCodeLine{00041         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classEQPStrategy}{EQPStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043     \textcolor{keywordflow}{if} (choice == 5)}
\DoxyCodeLine{00044         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classModCRRStrategy}{ModCRRStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k, S, \mbox{\hyperlink{namespacePayoffNamespace_ab501f4bdb2c74995b98b666056c671fb}{K}}, \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}});}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046     \textcolor{keywordflow}{if} (choice == 6)}
\DoxyCodeLine{00047         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classPadeJRStrategy}{PadeJRStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049     \textcolor{keywordflow}{if} (choice == 7)}
\DoxyCodeLine{00050         \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classPadeCRRStrategy}{PadeCRRStrategy}}(\mbox{\hyperlink{namespaceNSEuropeanOption_a974a1ee089fe6b1bb15292af1f2eef78}{sig}},\mbox{\hyperlink{namespaceNSEuropeanOption_adf476278b7e6a6960d82dc00e93ef723}{r}},k);}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052 \}}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054 }
\DoxyCodeLine{00055 \textcolor{comment}{// This could be made into a member function of Option}}
\DoxyCodeLine{\Hypertarget{director_8cc_source_l00056}\mbox{\hyperlink{director_8cc_aa3f446b0b1f8522f7b3f9a145a6a44b5}{00056}} \mbox{\hyperlink{classVector}{Vector<double, int>}} \mbox{\hyperlink{director_8cc_aa3f446b0b1f8522f7b3f9a145a6a44b5}{calcPayoffVector}}(\mbox{\hyperlink{classVector}{Vector<double, int>}} xarr, \textcolor{keyword}{const} \mbox{\hyperlink{classOption}{Option}}\& opt)}
\DoxyCodeLine{00057 \{}
\DoxyCodeLine{00058     \textcolor{comment}{// We need the form of the lattice at the 'base' of the pyramid. This}}
\DoxyCodeLine{00059     \textcolor{comment}{// will be needed when we use backward induction }}
\DoxyCodeLine{00060     }
\DoxyCodeLine{00061     \mbox{\hyperlink{classVector}{Vector<double, int>}} result (xarr);}
\DoxyCodeLine{00062 }
\DoxyCodeLine{00063     \textcolor{comment}{// Now use functionMechanisms }}
\DoxyCodeLine{00064     \textcolor{comment}{/* Vector<double, int> }}
\DoxyCodeLine{00065 \textcolor{comment}{            createDiscreteFunction(double (*f)(double x), const Vector<double, int>\& xarr); */}}
\DoxyCodeLine{00066 }
\DoxyCodeLine{00067     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = xarr.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}(); j <= xarr.\mbox{\hyperlink{classArray_a8ce7791cd1ec7ba63ec71772a7144965}{MaxIndex}}(); j++)}
\DoxyCodeLine{00068     \{}
\DoxyCodeLine{00069             result[j] = opt.\mbox{\hyperlink{classOption_a860218238db3dd970925771ebd27d53d}{payoff}}(xarr[j]);}
\DoxyCodeLine{00070     \}}
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{00073 \}}
\DoxyCodeLine{00074 }
\DoxyCodeLine{\Hypertarget{director_8cc_source_l00075}\mbox{\hyperlink{director_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{00075}} \textcolor{keywordtype}{int} \mbox{\hyperlink{director_8cc_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}}()}
\DoxyCodeLine{00076 \{}
\DoxyCodeLine{00077 L1:}
\DoxyCodeLine{00078     \textcolor{comment}{// Phase I: Create and initialise the option}}
\DoxyCodeLine{00079     \mbox{\hyperlink{classEuropeanOptionFactory}{EuropeanOptionFactory}}* fac = \mbox{\hyperlink{director_8cc_a6a4508a2b9d1fe00be954b686998d79e}{getFactory}}();}
\DoxyCodeLine{00080 }
\DoxyCodeLine{00081     \textcolor{keywordtype}{int} \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}} = 200;}
\DoxyCodeLine{00082     std::cout << \textcolor{stringliteral}{"Numbers of steps: "};}
\DoxyCodeLine{00083     std::cin >> \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}};}
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085     \textcolor{keywordtype}{double} S = 200;}
\DoxyCodeLine{00086     std::cout << \textcolor{stringliteral}{"Give underlying value: "};}
\DoxyCodeLine{00087     std::cin >> S;}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089     \mbox{\hyperlink{classOption}{Option}}* opt = fac -\/> create();}
\DoxyCodeLine{00090     \textcolor{keyword}{delete} fac;}
\DoxyCodeLine{00091 }
\DoxyCodeLine{00092     \textcolor{keywordtype}{double} k = opt-\/>\mbox{\hyperlink{classOption_ae583dd6d430a3b428014efa942605d54}{T}} / double (\mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}});}
\DoxyCodeLine{00093     std::cout << \textcolor{stringliteral}{"Step size "} << k << std::endl;}
\DoxyCodeLine{00094 }
\DoxyCodeLine{00095     \textcolor{comment}{// Create basic lattice}}
\DoxyCodeLine{00096     \textcolor{keywordtype}{double} discounting = \mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{std::exp}}(-\/ opt-\/>\mbox{\hyperlink{classOption_abd44ab56edddcd59f80ca5c60c9b66f0}{r}}*k);}
\DoxyCodeLine{00097     std::cout << \textcolor{stringliteral}{"Discounting "} << discounting << std::endl;}
\DoxyCodeLine{00098 }
\DoxyCodeLine{00099     \textcolor{comment}{// Phase II: Create the binomial method}}
\DoxyCodeLine{00100     \mbox{\hyperlink{classBinomialLatticeStrategy}{BinomialLatticeStrategy}}* lf = \mbox{\hyperlink{director_8cc_a1db1bf9e7954a5dd2efa2b2876a9a68a}{getStrategy}}(opt-\/>\mbox{\hyperlink{classOption_a8b68f88d3e7a01dfea0b83e3e5a4f57e}{sig}}, opt-\/>\mbox{\hyperlink{classOption_abd44ab56edddcd59f80ca5c60c9b66f0}{r}}, k, S, opt-\/>\mbox{\hyperlink{classOption_a40db81993d02b319a38e62b42a730d6a}{K}}, \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}});}
\DoxyCodeLine{00101     \mbox{\hyperlink{classBinomialMethod}{BinomialMethod}} bn(discounting, *lf, \mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}});}
\DoxyCodeLine{00102 }
\DoxyCodeLine{00103     \textcolor{comment}{// Phase III: Forward Induction}}
\DoxyCodeLine{00104     bn.\mbox{\hyperlink{classBinomialMethod_a232d7301afe8bab7df7ee5633ff841e6}{modifyLattice}}(S);}
\DoxyCodeLine{00105 \textcolor{comment}{//  print(bn.getLattice());}}
\DoxyCodeLine{00106 }
\DoxyCodeLine{00107     }
\DoxyCodeLine{00108     \textcolor{comment}{// Phase IV: Backward Induction}}
\DoxyCodeLine{00109     \mbox{\hyperlink{classVector}{Vector<double, int>}} RHS = bn.\mbox{\hyperlink{classBinomialMethod_ab3b69b60ccd9242119c3c5f6befc3690}{BasePyramidVector}}();}
\DoxyCodeLine{00110     \textcolor{keywordflow}{if} (lf -\/> binomialType() == \mbox{\hyperlink{BinomialLatticeStrategy_8hh_add398b812ca9f586ea244ce5a9dc8c99a0c6c9746e1005a59aad5820dd028191c}{Additive}})}
\DoxyCodeLine{00111     \{}
\DoxyCodeLine{00112         RHS[RHS.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}()] = S * \mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{::exp}}(\mbox{\hyperlink{TestImpliedVolatility_8cc_a6cbb82a21dec4c4f36c3f78340be64de}{N}} * lf -\/> downValue());}
\DoxyCodeLine{00113         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = RHS.\mbox{\hyperlink{classArray_acffe058a1dd631b05fb71a83e27b445a}{MinIndex}}() + 1; j <= RHS.\mbox{\hyperlink{classArray_a8ce7791cd1ec7ba63ec71772a7144965}{MaxIndex}}(); j++)}
\DoxyCodeLine{00114         \{}
\DoxyCodeLine{00115             RHS[j] = RHS[j-\/1] * \mbox{\hyperlink{Complex_8cc_aeb56775d93a065d4bd643a5ed679db8c}{exp}}(lf-\/>\mbox{\hyperlink{classBinomialLatticeStrategy_a66374392d012923a905648e01e278fda}{upValue}}() -\/ lf-\/>\mbox{\hyperlink{classBinomialLatticeStrategy_ac831614255b54ebf6e624b616748a7e2}{downValue}}());}
\DoxyCodeLine{00116         \}}
\DoxyCodeLine{00117     \}}
\DoxyCodeLine{00118 }
\DoxyCodeLine{00119     \mbox{\hyperlink{classVector}{Vector<double, int>}} Pay = \mbox{\hyperlink{director_8cc_aa3f446b0b1f8522f7b3f9a145a6a44b5}{calcPayoffVector}}(RHS, *opt);}
\DoxyCodeLine{00120 }
\DoxyCodeLine{00121     \textcolor{keywordtype}{double} pr = bn.\mbox{\hyperlink{classBinomialMethod_a62b8aa2bf9779858bbb0f27825af9268}{getPrice}}(Pay);}
\DoxyCodeLine{00122     std::cout << \textcolor{stringliteral}{"PriceN: "} << pr << std::endl;}
\DoxyCodeLine{00123 }
\DoxyCodeLine{00124     fac = \mbox{\hyperlink{director_8cc_a6a4508a2b9d1fe00be954b686998d79e}{getFactory}}();}
\DoxyCodeLine{00125     \textcolor{keywordflow}{goto} L1;}
\DoxyCodeLine{00126 }
\DoxyCodeLine{00127     \textcolor{keyword}{delete} lf; \textcolor{keyword}{delete} opt;}
\DoxyCodeLine{00128 }
\DoxyCodeLine{00129     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{00130 \}}

\end{DoxyCode}
